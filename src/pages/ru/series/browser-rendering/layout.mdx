---
layout: './_navigation.astro'
title: 'Layout stage'
series: 'browser-rendering'
pubDate: 'Jul 10 2021'
description: ''
---

import Img from 'src/components/Img.astro';

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –º—ã –≤—ã—á–∏—Å–ª–∏–ª–∏ –∫–∞–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –±—É–¥—É—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∏ –∫–∞–∫ –æ–Ω–∏ –±—É–¥—É—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å (–≤—ã—á–∏—Å–ª–∏–ª–∏ —Å—Ç–∏–ª–∏), –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–Ω—è—Ç—å, –∞ –≥–¥–µ –∂–µ –æ–Ω–∏ –±—É–¥—É—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∏ –∫–∞–∫–∏–µ —Ä–∞–∑–º–µ—Ä—ã –±—É–¥—É—Ç –∑–∞–Ω–∏–º–∞—Ç—å. –î—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏ –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã—á–∏—Å–ª–∏—Ç—å –≥–µ–æ–º–µ—Ç—Ä–∏—é —ç–ª–µ–º–µ–Ω—Ç–æ–≤.

–ó–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –≥–µ–æ–º–µ—Ç—Ä–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—Ç–≤–µ—á–∞–µ—Ç —à–∞–≥ layout ‚Äî –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –º–∞–∫–µ—Ç–∞. –ó–¥–µ—Å—å –º—ã –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã DOM –¥–µ—Ä–µ–≤–∞ —Å —É—á–µ—Ç–æ–º CCSOM –º–æ–¥–µ–ª–∏ –≤ Layout –¥–µ—Ä–µ–≤–æ.

–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–∑ DOM tree (–∏–ª–∏ Shadow DOM tree) –≤ Layout tree –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç 1 –∫ 1, –ø–æ—Å–∫–æ–ª—å–∫—É –Ω–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—ã—á–∏—Å–ª—è—Ç—å –≥–µ–æ–º–µ—Ç—Ä–∏—é –æ–±—ä–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è.

<Img
  src="/assets/posts/2021/browser-rendering-layout/layout-tree.jpg"
  width="1280"
  height="791"
/>

–¢–∞–∫–∂–µ –ø—Ä–∏—á–∏–Ω–∞ –ø–æ –∫–æ—Ç–æ—Ä–æ–π –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–µ 1 –∫ 1 –∏–∑ DOM tree –≤ Layout tree, –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —Ç–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å –æ–±–µ—Ä–Ω—É—Ç—ã –≤ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ (—Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–µ–º—ã–µ –∞–Ω–æ–Ω–∏–º–Ω—ã–µ) Layout –æ–±—ä–µ–∫—Ç—ã.

–ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã—à–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ html-—ç–ª–µ–º–µ–Ω—Ç–∞:

```html
<div style="max-width: 100px">
  <div style="float: left; padding: 1ex">F</div>
  <br />The <b>quick brown</b> fox
  <div style="margin: -60px 0 0 80px">jumps</div>
</div>
```

–ü—Ä–∏–º–µ—Ä –≤—ã—à–µ –≤–∑—è—Ç –∏–∑ –¥–æ–∫–ª–∞–¥: [Life of a Pixel](https://www.youtube.com/watch?v=m-J-tbAlFic)

–ó–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –º–∞–∫–µ—Ç–∞ –æ—Ç–≤–µ—á–∞–µ—Ç [layout –¥–≤–∏–∂–æ–∫](https://chromium.googlesource.com/chromium/blink/+/refs/heads/main/Source/core/layout/) –≤ —Å–æ—Å—Ç–∞–≤–µ Blink, –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–µ—Ç –æ–Ω –±—ã–ª –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω –∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –≤ [LayoutNG](https://chromium.googlesource.com/chromium/src/+/refs/heads/main/third_party/blink/renderer/core/layout/ng/README.md) –∏ —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –Ω–æ–≤–æ–≥–æ –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–Ω–æ–≥–æ –¥–≤–∏–∂–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ [RenderingNG](https://developer.chrome.com/blog/renderingng/). NG –∑–¥–µ—Å—å –æ–∑–Ω–∞—á–∞–µ—Ç next generation.

–ï—Å–ª–∏ –Ω–∞—á–Ω—ë—Ç–µ –ø–æ–≥—Ä—É–∂–∞—Ç—å—Å—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é Chromium, —Ä–∞–∑–±—Ä–æ—Å–∞–Ω–Ω—É—é –ø–æ README-—Ñ–∞–π–ª–∞–º –∏–ª–∏ –Ω–∞–π–¥–µ—Ç–µ –∫–∞–∫–æ–π-–Ω–∏–±—É–¥—å docs-—Ñ–∞–π–ª, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å [–æ–ø–∏—Å–∞–Ω–∏–µ–º —Ä–∞–±–æ—Ç—ã LayoutNG](https://docs.google.com/document/d/1uxbDh4uONFQOiGuiumlJBLGgO4KDWB8ZEkp7Rd47fw4) –∏–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ñ–∏—á–∏ —Ç–æ, –ø—Ä–∏–º–µ—Ä—ã, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –∏–ª–∏ –∫–ª–∞—Å—Å–æ–≤ –∏–º–µ—é—Ç NG –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ –Ω–æ–≤–æ–º—É –¥–≤–∏–∂–∫—É.

–ü–æ—ç—Ç–æ–º—É –≤—ã—à–µ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–∏–≤–µ–¥–µ–Ω—ã layout –¥–µ—Ä–µ–≤—å—è –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ä–∞–∑–Ω—ã–º–∏ –¥–≤–∏–∂–∫–∞–º–∏ –≤–Ω—É—Ç—Ä–∏ Blink.

–ù–∞–¥–µ—é—Å—å, —á—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞–∑–æ–±—Ä–∞–ª—Å—è –≤–æ –≤—Å–µ–º —ç—Ç–æ–º.

<Img
  src="/assets/posts/2021/browser-rendering-layout/layout-styles-grouped.jpg"
  width="1280"
  height="577"
/>

–¢–æ, –∫–∞–∫ –±—É–¥–µ—Ç –≤—ã—á–∏—Å–ª—è—Ç—å—Å—è layout, –∫–∞–∫–∞—è layout model –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è, –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è CSS-—Å–≤–æ–π—Å—Ç–≤–æ–º display.

–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ layout models: [box](https://www.w3.org/TR/css-box/), [table](https://drafts.csswg.org/css2/#table-display), [flexbox](https://www.w3.org/TR/css-flexbox-1/), [grid](https://www.w3.org/TR/css-grid-1/).

–ß—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –∫–∞–∫–∏–µ —Å—Ç–∏–ª–∏ —Ç–∞–∫–∂–µ –≤–ª–∏—è—é—Ç –Ω–∞ –±—É–¥—É—â–∏–π layout —ç–ª–µ–º–µ–Ω—Ç–∞ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ chrome devtools –≥—Ä—É–ø–ø—É —Å—Ç–∏–ª–µ–π, –∫–æ—Ç–æ—Ä–∞—è —Ç–∞–∫–∂–µ –∏ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è layout.

–ö–∞–∫ –ø–æ–Ω—è—Ç—å –∫–∞–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ CSS-—Å–≤–æ–π—Å—Ç–≤–∞ display —É —ç–ª–µ–º–µ–Ω—Ç–∞, –µ—Å–ª–∏ –º—ã –µ–≥–æ —è–≤–Ω–æ –Ω–∏–≥–¥–µ –Ω–µ —É–∫–∞–∑—ã–≤–∞–ª–∏? –ê –µ—Å–ª–∏ –±–µ–∑ –ø–æ–º–æ—â–∏ devtools? _**ü§∑‚Äç‚ôÇÔ∏è**_

–¢–æ, –∫–∞–∫–∏–µ —Å—Ç–∏–ª–∏ –±—É–¥—É—Ç —É —Ç–æ–≥–æ –∏–ª–∏ –∏–Ω–æ–≥–æ HTML-—ç–ª–µ–º–µ–Ω—Ç–∞ —Å –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è HTML-—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–µ–π, –≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏ —Ä–∞–∑–¥–µ–ª–æ–º [Rendering](https://html.spec.whatwg.org/multipage/rendering.html), –∞ —Å –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫ –º–æ–∂–µ—Ç –¥–æ–ø–æ–ª–Ω—è—Ç—å—Å—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –±—Ä–∞—É–∑–µ—Ä–æ–º.

–í [–∏—Å—Ö–æ–¥–Ω–∏–∫–∞—Ö Blink](https://chromium.googlesource.com/chromium/blink/+/refs/heads/main) –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ [—Å—Ç–∏–ª–∏ –¥–ª—è html-—Å—Ç—Ä–∞–Ω–∏—Ü](https://chromium.googlesource.com/chromium/blink/+/refs/heads/main/Source/core/css/html.css), –∞ —Ç–∞–∫–∂–µ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –¥—Ä—É–≥–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —Ç—ç–≥–æ–≤ [audio](https://chromium.googlesource.com/chromium/blink/+/refs/heads/main/Source/core/css/mediaControls.css), [video](https://chromium.googlesource.com/chromium/blink/+/refs/heads/main/Source/core/css/mediaControls.css), —Å—Ç–∏–ª–∏ –¥–ª—è [–ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞](https://chromium.googlesource.com/chromium/blink/+/refs/heads/main/Source/core/css/fullscreen.css), —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã [view-source](https://chromium.googlesource.com/chromium/blink/+/refs/heads/main/Source/core/css/view-source.css), –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –ø–æ–¥ android –≤–µ—Ä—Å–∏—é –∏ [—Ç–∞–∫ –¥–∞–ª–µ–µ](https://chromium.googlesource.com/chromium/blink/+/refs/heads/main/Source/core/css).

<Img
  src="/assets/posts/2021/browser-rendering-layout/layout-css-box-model.jpg"
  width="1280"
  height="967"
/>

–í devtools performance –ø—Ä–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–∏ –≤–∫–ª–∞–¥–∫–∏ computed styles –ª—é–±–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –º–æ–∂–Ω–æ –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å –µ–≥–æ css box model, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ –∫–∞–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ display —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ.

–≠—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å —Ç–µ–º, —á—Ç–æ display —Å–≤–æ–π—Å—Ç–≤–æ –∏–º–µ–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–µ (inline –∏–ª–∏ block) –∏ –≤–Ω–µ—à–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (flex, grid –∏–ª–∏ flow). –û—Ç–ª–∏—á–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —ç—Ç–æ–º—É –Ω–∞—à–µ–ª –Ω–∞ –∫–∞–Ω–∞–ª–µ [Mozilla Developer](https://www.youtube.com/channel/UCh5UlGiu9d6LegIeUCW4N1w) ‚Äî [Inner & Outer Values of the Display Property](https://www.youtube.com/watch?v=4Clyc38U-MA).

–ï—Å–ª–∏ –∫—Ä–∞—Ç–∫–æ, —Ç–æ CSS Box Model —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤ –≤–∏–¥–µ –±–ª–æ–∫–æ–≤, –≥–¥–µ –∫–∞–∂–¥—ã–π –±–ª–æ–∫ –∏–º–µ–µ—Ç –æ–±–ª–∞—Å—Ç—å —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º, –∞ —Ç–∞–∫–∂–µ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ (—Å–æ–≥–ª–∞—Å–Ω–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏) –æ–∫—Ä—É–∂–∞—é—â–∏–µ padding, border –∏ margin –æ–±–ª–∞—Å—Ç–∏ (—Å–º–æ—Ç—Ä–∏ –∫–∞—Ä—Ç–∏–Ω–∫—É –≤—ã—à–µ).

–ï—â–µ –≤–∞–∂–Ω–æ, —á—Ç–æ —Å—Ç–æ–∏—Ç –∑–Ω–∞—Ç—å ‚Äî margin –æ–±–ª–∞—Å—Ç–∏ —Å–æ—Å–µ–¥–Ω–∏—Ö –±–ª–æ–∫–æ–≤ [—Å—Ö–ª–æ–ø—ã–≤–∞—é—Ç—Å—è](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Box_Model/Mastering_margin_collapsing).

–ü—Ä–æ CSS Box Model –º–æ–∂–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –ø–æ—á–∏—Ç–∞—Ç—å –Ω–∞ [MDN](https://developer.mozilla.org/en-US/docs/Learn/CSS/Building_blocks/The_box_model), –≤ [—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏](https://www.w3.org/TR/css-box-3/) –∏–ª–∏ –≤ –∫—É—Ä—Å–µ [Learn CSS](https://web.dev/learn/css/box-model/).

–¢–∞–∫–∂–µ –Ω–∞ —ç—Ç–∞–ø–µ layout –≤ rendering pipeline –≤ Chromium –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –∏ —Ä–∞–∑–º–µ—Ä—ã —Ç–µ–∫—Å—Ç–∞ —Å —É—á–µ—Ç–æ–º –µ–≥–æ —Ç–∏–ø–æ–≥—Ä–∞—Ñ—Å–∫–∏—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π, –∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —ç—Ç–æ —Å –ø–æ–º–æ—â—å—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ [HarfBuzz](https://github.com/harfbuzz/harfbuzz).

<Img
  src="/assets/posts/2021/browser-rendering-layout/layout-task.jpg"
  width="1280"
  height="722"
/>

–í—Å–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è layout –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –≤ –æ–¥–Ω–æ–∏–º–µ–Ω–Ω–æ–π –∑–∞–¥–∞—á–µ, –∫–æ—Ç–æ—Ä–∞—è –∫ —Å–ª–æ–≤—É –≤—Å–µ–≥–¥–∞ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –≤ devtools performance –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å, –∞ –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏–ª–∏—Å—å –∑–∞–¥–∞—á–∏ Parse HTML –∏ Recalculate Style.
